{"version":3,"file":"CalloutSeries.js","sourceRoot":"","sources":["../../../../../../src/.internal/charts/stock/drawing/CalloutSeries.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Label } from \"../../../core/render/Label\";\r\nimport type { Container } from \"../../../core/render/Container\";\r\n\r\nimport { LabelSeries, ILabelSeriesSettings, ILabelSeriesPrivate, ILabelSeriesDataItem } from \"./LabelSeries\";\r\nimport { PointedRectangle } from \"../../../core/render/PointedRectangle\";\r\nimport type { DataItem } from \"../../../core/render/Component\";\r\nimport { Template } from \"../../../core/util/Template\";\r\n\r\nimport * as $ease from \"../../../core/util/Ease\";\r\n\r\nexport interface ICalloutSeriesDataItem extends ILabelSeriesDataItem {\r\n\r\n\t/**\r\n\t * Indicates whether callout will attach itself to the closest data item, as\r\n\t * opposed to exact location of the click.\r\n\t */\r\n\tsnapToData?: boolean;\r\n\r\n}\r\n\r\nexport interface ICalloutSeriesSettings extends ILabelSeriesSettings {\r\n\r\n\t/**\r\n\t * If set to `true`, callout will attach itself to the closest data item, as\r\n\t * opposed to exact location of the click.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tsnapToData?: boolean;\r\n\r\n}\r\n\r\nexport interface ICalloutSeriesPrivate extends ILabelSeriesPrivate {\r\n}\r\n\r\nexport class CalloutSeries extends LabelSeries {\r\n\tpublic static className: string = \"CalloutSeries\";\r\n\tpublic static classNames: Array<string> = LabelSeries.classNames.concat([CalloutSeries.className]);\r\n\r\n\tdeclare public _settings: ICalloutSeriesSettings;\r\n\tdeclare public _privateSettings: ICalloutSeriesPrivate;\r\n\tdeclare public _dataItemSettings: ICalloutSeriesDataItem;\r\n\r\n\tprotected _tag = \"callout\";\r\n\r\n\tprotected _afterNew() {\r\n\t\tsuper._afterNew();\r\n\t}\r\n\r\n\tprotected _tweakBullet2(label: Label, dataItem: DataItem<ICalloutSeriesDataItem>) {\r\n\t\tconst dataContext = dataItem.dataContext as any;\r\n\t\tlabel.set(\"background\", PointedRectangle.new(this._root, { themeTags: [\"callout\"] }, dataContext.bgSettings));\r\n\t}\r\n\r\n\tprotected _tweakBullet(container: Container, dataItem: DataItem<ICalloutSeriesDataItem>) {\r\n\t\tsuper._tweakBullet(container, dataItem);\r\n\r\n\t\tcontainer.events.off(\"click\");\r\n\r\n\t\tconst dataContext = dataItem.dataContext as any;\r\n\t\tconst template = dataContext.settings;\r\n\r\n\t\tconst label = this.getPrivate(\"label\");\r\n\t\tif (label) {\r\n\t\t\tlabel.events.on(\"positionchanged\", () => {\r\n\t\t\t\tthis._updatePointer(label);\r\n\t\t\t})\r\n\r\n\t\t\tlabel.events.on(\"click\", () => {\r\n\t\t\t\tconst spriteResizer = this.spriteResizer;\r\n\t\t\t\tif (spriteResizer.get(\"sprite\") == label) {\r\n\t\t\t\t\tspriteResizer.set(\"sprite\", undefined);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tspriteResizer.set(\"sprite\", label);\r\n\t\t\t\t}\r\n\t\t\t\tif (this._erasingEnabled) {\r\n\t\t\t\t\tthis._disposeIndex(dataContext.index);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tlabel.on(\"scale\", () => {\r\n\t\t\t\tthis._updatePointer(label);\r\n\t\t\t})\r\n\r\n\t\t\tlabel.on(\"rotation\", () => {\r\n\t\t\t\tthis._updatePointer(label);\r\n\t\t\t})\r\n\r\n\t\t\tlabel.setAll({ draggable: true });\r\n\r\n\t\t\tlabel.on(\"x\", (x) => {\r\n\t\t\t\ttemplate.set(\"x\", x);\r\n\t\t\t})\r\n\r\n\t\t\tlabel.on(\"y\", (y) => {\r\n\t\t\t\ttemplate.set(\"y\", y);\r\n\t\t\t})\r\n\r\n\t\t\tconst defaultState = label.states.lookup(\"default\")!;\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tlabel.animate({ key: \"y\", to: -label.height() / 2 - 10, from: 0, duration: defaultState.get(\"stateAnimationDuration\", 500), easing: defaultState.get(\"stateAnimationEasing\", $ease.out($ease.cubic)) })\r\n\t\t\t}, 50)\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _updatePointer(label: Label) {\r\n\t\tconst background = label.get(\"background\");\r\n\t\tif (background instanceof PointedRectangle) {\r\n\t\t\tconst parent = label.parent;\r\n\t\t\tif (parent) {\r\n\t\t\t\tlet point = parent.toGlobal({ x: 0, y: 0 });\r\n\t\t\t\tpoint = background.toLocal(point);\r\n\t\t\t\tbackground.setAll({ pointerX: point.x, pointerY: point.y });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _afterTextSave(dataContext: any) {\r\n\t\tdataContext.bgSettings = this._getBgTemplate();\r\n\t}\r\n\r\n\tprotected _hideAllBullets() {\r\n\r\n\t}\r\n\r\n\tprotected _getBgTemplate(): Template<any> {\r\n\t\tconst template: any = {};\r\n\r\n\t\tconst fill = this.get(\"fillColor\");\r\n\t\tif (fill != null) {\r\n\t\t\ttemplate.fill = fill;\r\n\t\t}\r\n\r\n\t\treturn Template.new(template);\r\n\t}\r\n\r\n\tprotected _setXLocation(dataItem: DataItem<this[\"_dataItemSettings\"]>, value: number) {\r\n\t\tif (!this.get(\"snapToData\")) {\r\n\t\t\tthis._setXLocationReal(dataItem, value);\r\n\t\t}\r\n\t}\r\n}"]}